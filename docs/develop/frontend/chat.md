# å³å¸­åˆ†æå‰ç«¯èŠå¤©æ¶ˆæ¯å¤„ç†æµç¨‹

## æœåŠ¡ç«¯æ¶ˆæ¯ç‰¹å¾

æ ¹æ® `docs/develop/modules/chat.md`ï¼ŒæœåŠ¡ç«¯è¿”å›çš„æ¶ˆæ¯å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š

### æ¶ˆæ¯ç±»å‹
1. **æ™®é€šæ–‡æœ¬æ¶ˆæ¯**ï¼šç›´æ¥åŒ…å«æ–‡æœ¬å†…å®¹
2. **ç‰¹æ®Šæ–‡æœ¬æ¶ˆæ¯**ï¼š`generate_response` å·¥å…·è°ƒç”¨ï¼Œå½“ä½œæ–‡æœ¬æ¶ˆæ¯å¤„ç†
3. **å·¥å…·è°ƒç”¨æ¶ˆæ¯**ï¼š`tool_use` å’Œ `tool_result` æˆå¯¹å‡ºç°
4. **æ¶ˆæ¯å®Œæˆæ¶ˆæ¯**ï¼š`message_completed` æ ‡è¯†ä¸€ä¸ªæ¶ˆæ¯çš„ç»“æŸ
5. **å“åº”å®Œæˆæ¶ˆæ¯**ï¼š`response_completed` æ ‡è¯†æ•´ä¸ªå“åº”çš„ç»“æŸ

### æµå¼è¿”å›ç‰¹å¾
- **å åŠ å¼è¿”å›**ï¼šæ¯ä¸ªServer Messageéƒ½æ˜¯å½“å‰messageçš„å®Œæ•´æ¶ˆæ¯ï¼ŒåŒ…å«å‰é¢çš„æ‰€æœ‰å†…å®¹

## åŸºæœ¬æ¦‚å¿µå®šä¹‰

### Server Messageï¼ˆæœåŠ¡ç«¯æ¶ˆæ¯ï¼‰

**æœåŠ¡ç«¯å‘é€çš„æœ€å°æ¶ˆæ¯å•å…ƒ**ï¼š

- **ç±»å‹**ï¼š
  - `message_update` - æ¶ˆæ¯æ›´æ–°
  - `message_completed` - æ¶ˆæ¯å®Œæˆ
  - `response_completed` - å“åº”å®Œæˆ
  - `status` - çŠ¶æ€æ¶ˆæ¯
  - `error` - é”™è¯¯æ¶ˆæ¯
- **ç»“æ„**ï¼š
  ```json
  {
    "session_id": "session_id",
    "type": "message_update",
    "message": {
      "id": "message_id",
      "content": [...]
    }
  }
  ```

### Display Message

**åœ¨UIå±‚é¢æ˜¾ç¤ºçš„æ¶ˆæ¯å—**ï¼š

- **å®šä¹‰**ï¼šåœ¨ç•Œé¢ä¸Šå®é™…æ˜¾ç¤ºçš„æ¶ˆæ¯å—ï¼Œå¯¹åº”ä¸€ä¸ªé€»è¾‘æ¶ˆæ¯
- **ç‰¹å¾**ï¼š
  - æ¯ä¸ªDisplay MessageåŒ…å«å®Œæ•´çš„æ˜¾ç¤ºå†…å®¹å’Œäº¤äº’çŠ¶æ€
  - å…·æœ‰æ˜ç¡®çš„UIè¾¹ç•Œå’Œè§†è§‰æ•ˆæœ
  - å¯¹åº”ChatMessageæ¥å£ç»„ä»¶
- **æ˜¾ç¤ºç­–ç•¥**ï¼š
  - æ–‡æœ¬Display Messageï¼šç›´æ¥æ˜¾ç¤ºæœ€æ–°å†…å®¹
  - å·¥å…·Display Messageï¼šæ˜¾ç¤ºå·¥å…·è°ƒç”¨å’Œç»“æœçš„ç»„åˆå†…å®¹
  - ç©ºDisplay Messageï¼šè‡ªåŠ¨æ¸…ç†ï¼Œä¸å ç”¨UIç©ºé—´

### çŠ¶æ€ç®¡ç†

- **currentMessageId**ï¼šå½“å‰æ­£åœ¨å¤„ç†çš„æ¶ˆæ¯ID
- **currentMessageContent**ï¼šå½“å‰æ¶ˆæ¯çš„æ˜¾ç¤ºå†…å®¹
- **messagesåˆ—è¡¨**ï¼šå­˜å‚¨æ‰€æœ‰ChatMessageçš„æ•°ç»„
- **isLoading**ï¼šåŠ è½½çŠ¶æ€ï¼Œæ§åˆ¶åŠ è½½æŒ‡ç¤ºå™¨æ˜¾ç¤º

### Server Messageå’ŒDisplay Messageçš„å…³ç³»

#### æœåŠ¡ç«¯å‘é€æµç¨‹
```
ç”¨æˆ·æŸ¥è¯¢
  â†“
æœåŠ¡ç«¯å¤„ç†
  â†“
Server Message 1 (æ–‡æœ¬) â†’ Display Message A
  â†“
Server Message 2 (æ–‡æœ¬) â†’ Display Message A (æ›´æ–°å†…å®¹)
  â†“
Server Message 3 (message_completed) â†’ Display Message A å®Œæˆ
  â†“
Server Message 4 (å·¥å…·è°ƒç”¨) â†’ Display Message B
  â†“
Server Message 5 (å·¥å…·ç»“æœ) â†’ Display Message B (ç´¯ç§¯å†…å®¹)
  â†“
Server Message 6 (message_completed) â†’ Display Message B å®Œæˆ
  â†“
Server Message 7 (response_completed) â†’ æ•´ä¸ªå“åº”å®Œæˆ
```

#### å¯¹åº”å…³ç³»è¡¨

| Server Messageç±»å‹ | Display Messageç±»å‹ | å¤„ç†æ–¹å¼ |
|-------------------|---------------------|---------|
| æ™®é€šæ–‡æœ¬ | æ–‡æœ¬Display Message | ç›´æ¥æ›¿æ¢å†…å®¹ |
| generate_response | æ–‡æœ¬Display Message | ç›´æ¥æ›¿æ¢å†…å®¹ |
| å·¥å…·è°ƒç”¨ | å·¥å…·Display Message | åˆ›å»ºæ–°æ˜¾ç¤ºå— |
| å·¥å…·ç»“æœ | å·¥å…·Display Message | ç´¯ç§¯åˆ°ç°æœ‰æ˜¾ç¤ºå— |
| message_completed | - | æ ‡è®°æ¶ˆæ¯å®Œæˆ |
| response_completed | - | æ ‡è®°æ•´ä¸ªå“åº”å®Œæˆ |

## å‰ç«¯æ¶ˆæ¯å¤„ç†é€»è¾‘

### è¯¦ç»†å¤„ç†æµç¨‹

#### 1. æ¶ˆæ¯å¤„ç†æµç¨‹

å½“æ¥æ”¶åˆ°æ–°çš„Server Messageæ—¶ï¼Œç»Ÿä¸€å¤„ç†é€»è¾‘ï¼Œæ ¹æ®æ¶ˆæ¯åŒ…çš„ç±»å‹æ‰§è¡Œç›¸åº”çš„å¤„ç†ï¼š

**ç»Ÿä¸€å¤„ç†é€»è¾‘ï¼ˆé€‚ç”¨äº message_update å’Œ message_completedï¼‰**ï¼š
1. æ£€æŸ¥æ¶ˆæ¯ç±»å‹æ˜¯å¦ä¸ºå†…å®¹ç±»å‹ï¼ˆmessage_update æˆ– message_completedï¼‰
2. éå†æ¶ˆæ¯åŒ…ä¸­çš„æ¯ä¸ªå†…å®¹å—
3. ä¸ºæ¯ä¸ªå†…å®¹å—ç”Ÿæˆç‹¬ç«‹çš„æ¶ˆæ¯ID

   **å¦‚æœæ˜¯æ–°çš„å†…å®¹å—**ï¼š
   1. è§£æè¯¥å†…å®¹å—ï¼Œè·å–åˆå§‹å†…å®¹
   2. åˆ›å»ºåŒ…å«åˆå§‹å†…å®¹çš„æ–°DisplayMessage
   3. è®¾ç½®æ¶ˆæ¯çš„messageIdä¸ºç”Ÿæˆçš„å†…å®¹å—å”¯ä¸€æ ‡è¯†
   4. å°†æ–°æ¶ˆæ¯æ·»åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨ä¸­
   5. å°†æ¶ˆæ¯IDå’Œæ¶ˆæ¯ç´¢å¼•æ·»åŠ åˆ°ç´¢å¼•ç¼“å­˜

   **å¦‚æœæ˜¯ç°æœ‰çš„å†…å®¹å—**ï¼š
   1. æ ¹æ®æ¶ˆæ¯ç±»å‹ï¼ˆæ–‡æœ¬Messageæˆ–å·¥å…·Messageï¼‰é‡‡ç”¨ç›¸åº”çš„å†…å®¹å¤„ç†ç­–ç•¥
   2. é€šè¿‡ç´¢å¼•ç¼“å­˜æ‰¾åˆ°å¯¹åº”çš„DisplayMessage
   3. æ›´æ–°è¯¥æ¶ˆæ¯çš„å†…å®¹

4. å¦‚æœæ¶ˆæ¯ç±»å‹ä¸º message_completedï¼Œé¢å¤–æ‰§è¡Œï¼š
   - éå†æ¶ˆæ¯åŒ…ä¸­çš„æ¯ä¸ªå†…å®¹å—
   - é€šè¿‡messageIdåœ¨æ¶ˆæ¯åˆ—è¡¨ä¸­æŸ¥æ‰¾å¯¹åº”çš„æ¶ˆæ¯
   - æ ‡è®°æ¯ä¸ªMessageä¸ºå®ŒæˆçŠ¶æ€
   - ä»ç´¢å¼•ç¼“å­˜ä¸­ç§»é™¤å¯¹åº”çš„æ¶ˆæ¯ID

**å¦‚æœæ˜¯å“åº”å®Œæˆç±»å‹æ¶ˆæ¯åŒ…ï¼ˆresponse_completedï¼‰**ï¼š
1. åœæ­¢åŠ è½½çŠ¶æ€æ˜¾ç¤º
2. å¦‚æœå½“å‰æœ‰æœªå®Œæˆçš„Messageï¼Œå…ˆå®Œæˆè¯¥Message
3. æ¸…ç©ºå½“å‰æ¶ˆæ¯ID
4. æ‰§è¡Œå…¨é¢çš„ç©ºæ¶ˆæ¯æ¸…ç†ï¼Œç§»é™¤æ¶ˆæ¯åˆ—è¡¨ä¸­æ‰€æœ‰ç©ºå†…å®¹çš„æ¶ˆæ¯
5. ç¡®ä¿æœ€ç»ˆç•Œé¢æ˜¾ç¤ºå¹²å‡€æ•´æ´ï¼Œæ²¡æœ‰æ®‹ç•™çš„ç©ºMessage

**å¦‚æœæ˜¯çŠ¶æ€æˆ–é”™è¯¯ç±»å‹æ¶ˆæ¯åŒ…ï¼ˆstatus, errorï¼‰**ï¼š
1. æ ¹æ®æ¶ˆæ¯ç±»å‹æ˜¾ç¤ºç›¸åº”çš„æç¤ºä¿¡æ¯
2. ä¸å½±å“å½“å‰çš„Messageå¤„ç†çŠ¶æ€

#### 2. æ¶ˆæ¯IDç”Ÿæˆ

æ¶ˆæ¯IDçš„ç”Ÿæˆéµå¾ªä»¥ä¸‹è§„åˆ™ï¼š

éå†æ¶ˆæ¯åŒ…æ•°ç»„ä¸­çš„æ¯ä¸ªå†…å®¹å—ï¼Œä¸ºæ¯ä¸ªå†…å®¹å—ç”Ÿæˆç‹¬ç«‹çš„æ¶ˆæ¯IDï¼š

- **æ–‡æœ¬å†…å®¹**ï¼šä½¿ç”¨ `text_` + `message.id` + `_$index` ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼ˆindexä¸ºå†…å®¹å—åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼‰
- **ç‰¹æ®Šæ–‡æœ¬æ¶ˆæ¯**ï¼ˆgenerate_responseå·¥å…·è°ƒç”¨ï¼‰ï¼šå½“ä½œæ–‡æœ¬æ¶ˆæ¯å¤„ç†ï¼Œä½¿ç”¨ `text_` + `message.id` + `_$index` ä½œä¸ºå”¯ä¸€æ ‡è¯†
- **å·¥å…·è°ƒç”¨**ï¼šä½¿ç”¨ `tool_` + `message.content.id` ä½œä¸ºå”¯ä¸€æ ‡è¯†
- **å·¥å…·ç»“æœ**ï¼šä½¿ç”¨ `tool_` + `message.content.id` ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼ˆä¸å¯¹åº”çš„å·¥å…·è°ƒç”¨ç›¸åŒï¼‰

**ç´¢å¼•ç¼“å­˜æœºåˆ¶**ï¼š
- ç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯IDåˆ°DisplayMessageç´¢å¼•çš„æ˜ å°„ç¼“å­˜
- å½“æ”¶åˆ°æ–°çš„Server Messageæ—¶ï¼Œé€šè¿‡å†…å®¹å—çš„å”¯ä¸€æ ‡è¯†åœ¨ç¼“å­˜ä¸­æŸ¥æ‰¾å¯¹åº”çš„DisplayMessage
- å¦‚æœæ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯ï¼Œåˆ™æ›´æ–°è¯¥æ¶ˆæ¯çš„å†…å®¹
- å¦‚æœæœªæ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯ï¼Œåˆ™åˆ›å»ºæ–°çš„DisplayMessageå¹¶æ·»åŠ åˆ°ç¼“å­˜

è¿™æ ·å¯ä»¥ç¡®ä¿ï¼š
1. æ¯ä¸ªå†…å®¹å—éƒ½æœ‰ç‹¬ç«‹çš„DisplayMessage
2. å·¥å…·è°ƒç”¨å’Œå·¥å…·ç»“æœèƒ½å¤Ÿæ­£ç¡®åŒ¹é…
3. æ–‡æœ¬æ¶ˆæ¯èƒ½å¤Ÿæ­£ç¡®æ›´æ–°

#### 3. å†…å®¹æ›´æ–°å¤„ç†

æ ¹æ®æ¶ˆæ¯IDçš„ç±»å‹é‡‡ç”¨ä¸åŒçš„å†…å®¹å¤„ç†ç­–ç•¥ï¼š

**å·¥å…·Messageå¤„ç†ï¼ˆæ¶ˆæ¯IDä»¥tool_å¼€å¤´ï¼‰**ï¼š
- é‡‡ç”¨ç´¯ç§¯ç­–ç•¥ï¼Œå› ä¸ºå·¥å…·è°ƒç”¨å’Œå·¥å…·ç»“æœæ˜¯æœåŠ¡ç«¯è¿”å›çš„ä¸¤ä¸ªä¸åŒServer Message
- å¦‚æœå½“å‰å†…å®¹å’Œæ–°çš„å†…å®¹éƒ½æœ‰å®é™…å†…å®¹ï¼Œæ£€æŸ¥æ–°å†…å®¹æ˜¯å¦å·²åŒ…å«åœ¨å½“å‰å†…å®¹ä¸­
- å¦‚æœæ–°å†…å®¹æœªè¢«åŒ…å«ï¼Œåˆ™å°†æ–°å†…å®¹è¿½åŠ åˆ°å½“å‰å†…å®¹ä¸­ï¼ˆç”¨æ¢è¡Œç¬¦åˆ†éš”ï¼‰
- å¦åˆ™ç›´æ¥æ›¿æ¢ä¸ºæ–°å†…å®¹

**æ–‡æœ¬Messageå¤„ç†ï¼ˆæ¶ˆæ¯IDä»¥text_å¼€å¤´ï¼‰**ï¼š
- é‡‡ç”¨ç›´æ¥æ›¿æ¢ç­–ç•¥ï¼Œå› ä¸ºæœåŠ¡ç«¯é‡‡ç”¨å åŠ å¼è¿”å›
- æ¯ä¸ªServer Messageéƒ½åŒ…å«å‰é¢çš„æ‰€æœ‰å†…å®¹ï¼Œæ‰€ä»¥ç›´æ¥æ›¿æ¢ä¸ºæœ€æ–°å†…å®¹å³å¯
- è¿™æ ·é¿å…é‡å¤æ˜¾ç¤ºï¼Œç¡®ä¿åªæ˜¾ç¤ºæœ€ç»ˆçš„å®Œæ•´å†…å®¹

**å¤šå†…å®¹å—å¤„ç†**ï¼š
- å½“æ”¶åˆ°åŒ…å«å¤šä¸ªå†…å®¹å—çš„Server Messageæ—¶ï¼Œéå†æ¯ä¸ªå†…å®¹å—
- ä¸ºæ¯ä¸ªå†…å®¹å—ç”Ÿæˆç‹¬ç«‹çš„æ¶ˆæ¯ID
- ä½¿ç”¨ç´¢å¼•ç¼“å­˜æŸ¥æ‰¾å¯¹åº”çš„DisplayMessage
- å¦‚æœæ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯ï¼Œåˆ™æ›´æ–°è¯¥æ¶ˆæ¯çš„å†…å®¹
- å¦‚æœæœªæ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯ï¼Œåˆ™åˆ›å»ºæ–°çš„DisplayMessageå¹¶æ·»åŠ åˆ°ç¼“å­˜

**ç´¢å¼•ç¼“å­˜æœºåˆ¶**ï¼š
- ç»´æŠ¤ä¸€ä¸ª`messageIdToIndex`æ˜ å°„ï¼Œå­˜å‚¨æ¶ˆæ¯IDåˆ°DisplayMessageç´¢å¼•çš„å¯¹åº”å…³ç³»
- å½“åˆ›å»ºæ–°æ¶ˆæ¯æ—¶ï¼Œå°†æ¶ˆæ¯IDå’Œæ¶ˆæ¯ç´¢å¼•æ·»åŠ åˆ°ç¼“å­˜
- å½“æ›´æ–°æ¶ˆæ¯æ—¶ï¼Œé€šè¿‡æ¶ˆæ¯IDå¿«é€ŸæŸ¥æ‰¾å¯¹åº”çš„DisplayMessage
- å½“æ¶ˆæ¯å®Œæˆæ—¶ï¼Œä»ç¼“å­˜ä¸­ç§»é™¤å¯¹åº”çš„æ¶ˆæ¯ID

å¤„ç†å®Œå†…å®¹æ›´æ–°åï¼Œè°ƒç”¨æ˜¾ç¤ºæ›´æ–°å‡½æ•°æ¥åˆ·æ–°ç•Œé¢ã€‚

#### 4. å†…å®¹è§£æ

å†…å®¹è§£æå°†æœåŠ¡ç«¯è¿”å›çš„å¤æ‚æ¶ˆæ¯åŒ…ç»“æ„è½¬æ¢ä¸ºå‰ç«¯æ˜¾ç¤ºçš„æ–‡æœ¬æ ¼å¼ï¼š

éå†æ¶ˆæ¯åŒ…æ•°ç»„ä¸­çš„æ¯ä¸ªå—ï¼š
- **æ–‡æœ¬å—**ï¼šç›´æ¥è¿½åŠ æ–‡æœ¬å†…å®¹
- **generate_responseå·¥å…·è°ƒç”¨**ï¼šç‰¹æ®Šå¤„ç†ï¼Œç›´æ¥æ˜¾ç¤ºå“åº”å†…å®¹ï¼Œä¸æ˜¾ç¤ºå·¥å…·è°ƒç”¨ä¿¡æ¯
- **å…¶ä»–å·¥å…·è°ƒç”¨**ï¼šæ˜¾ç¤ºå·¥å…·å›¾æ ‡å’Œå·¥å…·åç§°
- **å·¥å…·ç»“æœ**ï¼šæ˜¾ç¤ºå·¥å…·åç§°å’ŒæˆåŠŸçŠ¶æ€ï¼Œä¸æ˜¾ç¤ºè¯¦ç»†çš„è¾“å‡ºæ–‡æœ¬

æœ€ç»ˆè¿”å›è§£æåçš„å†…å®¹æ–‡æœ¬ï¼Œå»é™¤é¦–å°¾ç©ºç™½å­—ç¬¦ã€‚

### æ¶ˆæ¯æ˜¾ç¤ºç¤ºä¾‹

#### æ–‡æœ¬æ¶ˆæ¯å¤„ç†æµç¨‹
```
æœåŠ¡ç«¯Server Message 1: "ä½ å¥½"
  â†’ æ¶ˆæ¯ID: text_msg1
  â†’ æ¶ˆæ¯å†…å®¹: "ä½ å¥½"

æœåŠ¡ç«¯Server Message 2: "ä½ å¥½ï¼Œä¸–ç•Œ" (åŒ…å«å‰é¢çš„"ä½ å¥½")
  â†’ æ¶ˆæ¯ID: text_msg1 (ç›¸åŒ)
  â†’ æ¶ˆæ¯å†…å®¹: "ä½ å¥½ï¼Œä¸–ç•Œ" (ç›´æ¥æ›¿æ¢ä¸Šä¸€ä¸ª)

æœåŠ¡ç«¯Server Message 3: "ä½ å¥½ï¼Œä¸–ç•Œï¼" (åŒ…å«å‰é¢çš„æ‰€æœ‰å†…å®¹)
  â†’ æ¶ˆæ¯ID: text_msg1 (ç›¸åŒ)
  â†’ æ¶ˆæ¯å†…å®¹: "ä½ å¥½ï¼Œä¸–ç•Œï¼" (ç›´æ¥æ›¿æ¢ä¸Šä¸€ä¸ª)

æœåŠ¡ç«¯Server Message 4 (message_completed)
  â†’ æ¶ˆæ¯ID: text_msg1 (å®Œæˆ)
  â†’ æ¶ˆæ¯å†…å®¹: "ä½ å¥½ï¼Œä¸–ç•Œï¼" (æœ€ç»ˆå†…å®¹)
  â†’ æ¸…ç†æ¶ˆæ¯çŠ¶æ€

æœ€ç»ˆæ˜¾ç¤ºï¼š1ä¸ªæ–‡æœ¬Message
```

#### å·¥å…·æ¶ˆæ¯å¤„ç†æµç¨‹
```
æœåŠ¡ç«¯å·¥å…·è°ƒç”¨Server Message (åŒ…å«å¤šä¸ªå·¥å…·è°ƒç”¨):
  â†’ å†…å®¹å—1: "ğŸ”§ å·¥å…·è°ƒç”¨: execute_python_code"
    â†’ æ¶ˆæ¯ID: tool_call_123
    â†’ æ¶ˆæ¯å†…å®¹: "ğŸ”§ å·¥å…·è°ƒç”¨: execute_python_code"
  â†’ å†…å®¹å—2: "ğŸ”§ å·¥å…·è°ƒç”¨: execute_python_code_2"
    â†’ æ¶ˆæ¯ID: tool_call_456
    â†’ æ¶ˆæ¯å†…å®¹: "ğŸ”§ å·¥å…·è°ƒç”¨: execute_python_code_2"

æœåŠ¡ç«¯å·¥å…·ç»“æœServer Message (åŒ…å«å¤šä¸ªå·¥å…·ç»“æœ):
  â†’ å†…å®¹å—1: "âœ… execute_python_code å·¥å…·è°ƒç”¨æˆåŠŸ"
    â†’ æ¶ˆæ¯ID: tool_call_123 (ç›¸åŒ)
    â†’ æ¶ˆæ¯å†…å®¹:
      "ğŸ”§ å·¥å…·è°ƒç”¨: execute_python_code"
      "âœ… execute_python_code å·¥å…·è°ƒç”¨æˆåŠŸ" (ç´¯ç§¯æ˜¾ç¤º)
  â†’ å†…å®¹å—2: "âœ… execute_python_code_2 å·¥å…·è°ƒç”¨æˆåŠŸ"
    â†’ æ¶ˆæ¯ID: tool_call_456 (ç›¸åŒ)
    â†’ æ¶ˆæ¯å†…å®¹:
      "ğŸ”§ å·¥å…·è°ƒç”¨: execute_python_code_2"
      "âœ… execute_python_code_2 å·¥å…·è°ƒç”¨æˆåŠŸ" (ç´¯ç§¯æ˜¾ç¤º)

æœåŠ¡ç«¯Server Message (message_completed)
  â†’ æ ‡è®°æ‰€æœ‰æ¶ˆæ¯å®Œæˆï¼Œæ¸…ç†æ¶ˆæ¯çŠ¶æ€

æœ€ç»ˆæ˜¾ç¤ºï¼š2ä¸ªå·¥å…·Messageï¼ˆæ¯ä¸ªåŒ…å«å¯¹åº”çš„å·¥å…·è°ƒç”¨å’Œç»“æœï¼‰
```

#### æ··åˆæ¶ˆæ¯å¤„ç†æµç¨‹
```
æœåŠ¡ç«¯Server Message (åŒ…å«æ–‡æœ¬å’Œå·¥å…·è°ƒç”¨):
  â†’ å†…å®¹å—1: "æˆ‘éœ€è¦åˆ†ææ•°æ®"
    â†’ æ¶ˆæ¯ID: text_msg1_0
    â†’ æ¶ˆæ¯å†…å®¹: "æˆ‘éœ€è¦åˆ†ææ•°æ®"
  â†’ å†…å®¹å—2: "ğŸ”§ å·¥å…·è°ƒç”¨: execute_python_code"
    â†’ æ¶ˆæ¯ID: tool_call_123
    â†’ æ¶ˆæ¯å†…å®¹: "ğŸ”§ å·¥å…·è°ƒç”¨: execute_python_code"

æœåŠ¡ç«¯Server Message (æ›´æ–°æ–‡æœ¬å†…å®¹):
  â†’ å†…å®¹å—1: "æˆ‘éœ€è¦åˆ†ææ•°æ®ï¼Œè¯·ç¨ç­‰"
    â†’ æ¶ˆæ¯ID: text_msg1_0 (ç›¸åŒ)
    â†’ æ¶ˆæ¯å†…å®¹: "æˆ‘éœ€è¦åˆ†ææ•°æ®ï¼Œè¯·ç¨ç­‰" (ç›´æ¥æ›¿æ¢)

æœåŠ¡ç«¯Server Message (å·¥å…·ç»“æœ):
  â†’ å†…å®¹å—1: "âœ… execute_python_code å·¥å…·è°ƒç”¨æˆåŠŸ"
    â†’ æ¶ˆæ¯ID: tool_call_123 (ç›¸åŒ)
    â†’ æ¶ˆæ¯å†…å®¹:
      "ğŸ”§ å·¥å…·è°ƒç”¨: execute_python_code"
      "âœ… execute_python_code å·¥å…·è°ƒç”¨æˆåŠŸ" (ç´¯ç§¯æ˜¾ç¤º)

æœåŠ¡ç«¯Server Message (message_completed)
  â†’ æ ‡è®°æ‰€æœ‰æ¶ˆæ¯å®Œæˆï¼Œæ¸…ç†æ¶ˆæ¯çŠ¶æ€

æœ€ç»ˆæ˜¾ç¤ºï¼š1ä¸ªæ–‡æœ¬Message + 1ä¸ªå·¥å…·Message
```
